{
  "hash": "b399f8b2c073e4b36eba380a7f96ff99",
  "result": {
    "markdown": "---\ntitle: \"Exercice 2.01\"\nauthor: \"Clément Poupelin\"\ndate: \"2025-02-xx\"\ndate-modified: \"2025-03-02\"\nformat: \n  html:\n    embed-resources: false\n    toc: true\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-tools: true\n    toc-location: right\n    page-layout: article\n    code-overflow: wrap\ntoc: true\nnumber-sections: false\neditor: visual\ncategories: [\"Fiche 2\", \"Marche aléatoire\", \"Signal linéraire bruité\"]\nimage: \"\"\ndescription: \"L'objectif de ce document est détudier la différence entre une **marche aléatoire** et un **signal linéraire bruité**\"\n---\n\n\n# Intervenant.e.s\n\n### Rédaction\n\n-   **Clément Poupelin**, [clementjc.poupelin\\@gmail.com](mailto:clementjc.poupelin@gmail.com){.email}\\\n\n### Relecture\n\n-   \n\n# Setup\n\n:::: panel-tabset\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Données\nlibrary(dplyr)        # manipulation des données\n\nlibrary(latex2exp)\n\n# Plots\n## ggplot\nlibrary(ggplot2)\nlibrary(gridExtra)\n```\n:::\n\n\n## Fonctions\n\n::: panel-tabset\n### Marche aléatoire\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrandom_walk <- function(n, delta) {\n  w <- rnorm(n)  \n  drift <- delta * seq(1, n)  \n  \n  x <- drift + cumsum(w)\n  return(x)  \n}\n```\n:::\n\n\n### Signal linéaire bruité\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnoisy_serie <- function(n, delta) {\n  w <- rnorm(n, sd = 1)  \n  drift <- delta * seq(1, n) \n  \n  x <- drift + w\n  return(x)  \n}\n```\n:::\n\n\n### Plot des simulations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_simulation_time_series <- function(data, main_title, y_lab) {\n  plot_data <- data.frame(\n    Time = rep(1:n, I),\n    Value = as.vector(data),\n    Group = rep(1:I, each = n)\n  )\n  \n  ggplot(plot_data, aes(\n    x = Time,\n    y = Value,\n    group = Group,\n    color = factor(Group)\n  )) +\n    geom_line() +\n    scale_color_viridis_d(name = \"Time séries\")  +\n    labs(title = main_title,\n    x = \"Time\",\n    y = y_lab) +\n    theme_minimal() + \n    theme(legend.title = element_text(size = 18),\n          legend.text = element_text(size = 12),\n          axis.title = element_text(size = 16),\n          axis.text = element_text(size = 14),\n          plot.title = element_text(size = 18, face = \"bold\"))\n  \n}\n```\n:::\n\n:::\n\n## Seed\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(140400)\n```\n:::\n\n::::\n\n# Données\n\nPour cette exercice, nous allons étudier deux types de séries temporelles : **les marches aléatoires** et **les signaux linéaires bruités**.\n\nPour cela nous allons simuler :\n\n-   dix marches aléatoires $(x^1_t)_t$de la forme $x^1_t = \\delta + w_t$ avec dérive de longueur $n=100$, de paramètre $\\delta=.01$ et de variance $\\sigma_W^2 = 1$ pour le bruit.\n\n-   dix séries $(x^2_t)_t$ de la forme $x^2_t = \\delta t + w_t$ (tendance + bruit blanc) de longueur $n = 100$, de paramètre $\\delta = .01$ et de variance $\\sigma^2_W = 1$\n\n::: callout-note\nSi on pose que $x_0 = w_0$, on peut écrire notre marche aléatoire comme $x_t = \\delta t + \\sum_{i=0}^{t}w_i$\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 100      ## length    \ndelta <- .01  ## drift parameter   \nI <- 10       ## number of series\n```\n:::\n\n\n::: panel-tabset\n## Marche aléatoire\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim <- t(simplify2array(lapply(1:I, function(i) random_walk(n, delta))))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_simulation_time_series(sim, main_title = TeX(paste(\"Simulation of\", I, \"Random Walks with drift $\\\\delta$ =\", delta)), y_lab = \"Random Walk\")\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-7-1.png){width=1152}\n:::\n:::\n\n\n## Signal linéaire bruité\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim2 <- t(simplify2array(lapply(1:I, function(i) noisy_serie(n, delta))))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_simulation_time_series(sim2, main_title = paste(\"Simulation of\", I, \"linear noisy series\"), y_lab = \"Noisy serie\")\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-9-1.png){width=1152}\n:::\n:::\n\n:::\n\n# Estimation du modèle de régression linéaire\n\nPour les deux types de séries, nous allons estimer le modèle de régression linéaire \n$$x^\\xi_t = \\beta t + w_t \\quad \\text{pour} \\quad \\xi=1,2$$\n\n::: panel-tabset\n## Marche aléatoire\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_coeff <- apply(sim, 1, function(x) {\n  mod <- lm(x ~ 0 + seq(1, n)) \n  return(mod$coefficients)  \n})\n\ndf_sim_coeff <- data.frame(coeff = paste(\"beta_\", seq(1,10)), estimation = round(sim_coeff, 3))\n\nt(df_sim_coeff) %>% DT::datatable()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-5ca2671e1d845ab306c1\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5ca2671e1d845ab306c1\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"coeff\",\"estimation\"],[\"beta_ 1\",\"-0.008\"],[\"beta_ 2\",\"-0.026\"],[\"beta_ 3\",\"-0.036\"],[\"beta_ 4\",\"-0.209\"],[\"beta_ 5\",\" 0.140\"],[\"beta_ 6\",\" 0.184\"],[\"beta_ 7\",\" 0.107\"],[\"beta_ 8\",\" 0.015\"],[\"beta_ 9\",\"-0.214\"],[\"beta_ 10\",\" 0.069\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>V1<\\/th>\\n      <th>V2<\\/th>\\n      <th>V3<\\/th>\\n      <th>V4<\\/th>\\n      <th>V5<\\/th>\\n      <th>V6<\\/th>\\n      <th>V7<\\/th>\\n      <th>V8<\\/th>\\n      <th>V9<\\/th>\\n      <th>V10<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"V1\",\"targets\":1},{\"name\":\"V2\",\"targets\":2},{\"name\":\"V3\",\"targets\":3},{\"name\":\"V4\",\"targets\":4},{\"name\":\"V5\",\"targets\":5},{\"name\":\"V6\",\"targets\":6},{\"name\":\"V7\",\"targets\":7},{\"name\":\"V8\",\"targets\":8},{\"name\":\"V9\",\"targets\":9},{\"name\":\"V10\",\"targets\":10}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Signal linéaire bruité\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim2_coeff <- apply(sim2, 1, function(x) {\n  mod <- lm(x ~ 0 + seq(1, n))  \n  return(mod$coefficients)  \n})\ndf_sim2_coeff <- data.frame(coeff = paste(\"beta_\", seq(1,10)), estimation = round(sim2_coeff, 3))\n\nt(df_sim2_coeff) %>% DT::datatable()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-b57d78979e16a7b99a95\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b57d78979e16a7b99a95\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"coeff\",\"estimation\"],[\"beta_ 1\",\"0.009\"],[\"beta_ 2\",\"0.010\"],[\"beta_ 3\",\"0.010\"],[\"beta_ 4\",\"0.013\"],[\"beta_ 5\",\"0.010\"],[\"beta_ 6\",\"0.013\"],[\"beta_ 7\",\"0.009\"],[\"beta_ 8\",\"0.011\"],[\"beta_ 9\",\"0.010\"],[\"beta_ 10\",\"0.010\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>V1<\\/th>\\n      <th>V2<\\/th>\\n      <th>V3<\\/th>\\n      <th>V4<\\/th>\\n      <th>V5<\\/th>\\n      <th>V6<\\/th>\\n      <th>V7<\\/th>\\n      <th>V8<\\/th>\\n      <th>V9<\\/th>\\n      <th>V10<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"V1\",\"targets\":1},{\"name\":\"V2\",\"targets\":2},{\"name\":\"V3\",\"targets\":3},{\"name\":\"V4\",\"targets\":4},{\"name\":\"V5\",\"targets\":5},{\"name\":\"V6\",\"targets\":6},{\"name\":\"V7\",\"targets\":7},{\"name\":\"V8\",\"targets\":8},{\"name\":\"V9\",\"targets\":9},{\"name\":\"V10\",\"targets\":10}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n:::\n\nAvec ces résulats, nous pouvons par la suite représenter sur un même graphique les dix droites estimées et la tendance moyenne théorique $\\delta t=.01t$.\n\n::::::::: panel-tabset\n## Marche aléatoire\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntime <- seq(1, n)\n\n# Créer un data.frame pour les courbes simulées\nsim_data <- data.frame(\n  time = rep(time, I),\n  value = unlist(lapply(1:I, function(i) sim_coeff[i] * time)),\n  group = rep(1:I, each = n)\n)\n\n# Créer la ligne théorique\ntheoretical_trend <- data.frame(\n  time = time,\n  value = 0.01 * time,\n  group = \"Theoretical Trend\"\n)\n\n# Plot avec ggplot\nlibrary(ggplot2)\n\nggplot(sim_data, aes(x = time, y = value, group = group, color = factor(group))) +\n  geom_line(size = .5, color = \"orange\") +  # Courbes simulées\n  geom_line(data = theoretical_trend, aes(x = time, y = value), color = \"red\", linetype = \"dashed\", size = 1.) +  # Ligne théorique\n  labs(\n    title = \"Graphe of the estimations\",\n    x = \"Time\",\n    y = \"Estimated values\",\n    color = \"Simulated Curves\"\n  ) +\n  scale_color_manual(values = rep(\"orange\", I)) +  # Couleur orange pour toutes les courbes simulées\n  theme_minimal() +\n  theme(legend.position = \"topleft\") +\n  annotate(\"text\", x = 10, y = 9, label = TeX(\"Theoretical trend $\\\\delta_t = 0.01t$\"), color = \"red\", hjust = 0)\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n:::: success-header\n::: success-icon\n:::\n\nRésultats\n::::\n\n::: success\nNous pouvons facilement voir que les estimations ne semble pas du tout suivre la tendance moyenne théoriques.\\\nLa variance des estimations semble même croitre au cours du temps.\n:::\n\n## Signal linéaire bruité\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntime <- seq(1, n)\n\n# Créer un data.frame pour les courbes simulées\nsim_data <- data.frame(\n  time = rep(time, I),\n  value = unlist(lapply(1:I, function(i) sim2_coeff[i] * time)),\n  group = rep(1:I, each = n)\n)\n\n# Créer la ligne théorique\ntheoretical_trend <- data.frame(\n  time = time,\n  value = 0.01 * time,\n  group = \"Theoretical Trend\"\n)\n\n\nggplot(sim_data, aes(x = time, y = value, group = group, color = factor(group))) +\n  geom_line(size = .5, color = \"orange\") +  # Courbes simulées\n  geom_line(data = theoretical_trend, aes(x = time, y = value), color = \"red\", linetype = \"dashed\", size = 1.) +  # Ligne théorique\n  labs(\n    title = \"Graphe of the estimations\",\n    x = \"Time\",\n    y = \"Estimated values\",\n    color = \"Simulated Curves\"\n  ) +\n  scale_color_manual(values = rep(\"orange\", I)) +  # Couleur orange pour toutes les courbes simulées\n  theme_minimal() +\n  theme(legend.position = \"topleft\") +\n  annotate(\"text\", x = 10, y = 9, label = TeX(\"Theoretical trend $\\\\delta_t = 0.01t$\"), color = \"red\", hjust = 0)\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n:::: success-header\n::: success-icon\n:::\n\nRésultats\n::::\n\n::: success\nNous constatons ici que l'estimation semble très bien fonctionner avec des lignes qui semblent toutes proches de la tendance moyenne théorique.\n:::\n:::::::::\n\n# Conclusion\n\nNous avons pu voir avec cette exercice que la tendance théorique (le drift) est mieux estimée par régression dans le cas d'un signal bruité que celui de la marche aléatoire.\n\nCela s'explique par le fait que, dans le cas de la marche aléatoire, la variance de $x_t$ croît linéairement avec le temps. En effet, \n\\begin{align*} \nVar(x_t) &= Var(\\delta t + \\sum_{i=0}^{t}w_i)\\\\\n&= Var(\\sum_{i=0}^{t}w_i)\\\\ \n&= \\sum_{i=0}^{t}Var(w_i)\\\\ \n&= \\sum_{i=0}^{t}\\sigma^2_w\\\\ \n&= t\\sigma^2_w \n\\end{align*}\n\nCela fait donc défaut à l'hypothèse d'homoscédacité cruciale pour la régression linéaire.\n\nPar contre, du côté du signal bruite on conserve l'homoscédacité avec le cas très idéal du bruit iid (indépendant et identiquement distribué) et gaussien. \n\n# Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info(pkgs = \"attached\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.1 (2022-06-23 ucrt)\n os       Windows 10 x64 (build 22631)\n system   x86_64, mingw32\n ui       RTerm\n language (EN)\n collate  French_France.utf8\n ctype    French_France.utf8\n tz       Europe/Paris\n date     2025-03-02\n pandoc   3.2 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package   * version date (UTC) lib source\n dplyr     * 1.1.4   2023-11-17 [1] CRAN (R 4.2.3)\n ggplot2   * 3.5.1   2024-04-23 [1] CRAN (R 4.2.3)\n gridExtra * 2.3     2017-09-09 [1] CRAN (R 4.2.1)\n latex2exp * 0.9.6   2022-11-28 [1] CRAN (R 4.2.3)\n\n [1] C:/Users/cleme/AppData/Local/R/win-library/4.2\n [2] C:/Program Files/R/R-4.2.1/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n",
    "supporting": [
      "Exercice_02.01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\r\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\r\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\r\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\r\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}