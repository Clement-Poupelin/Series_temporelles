{
  "hash": "42172eedc81cb66f3603d1f8807c3570",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercice 2.01\"\nauthor: \"Clément Poupelin\"\ndate: \"2025-03-03\"\ndate-modified: \"2025-03-03\"\nformat: \n  html:\n    embed-resources: false\n    toc: true\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-tools: true\n    toc-location: right\n    page-layout: article\n    code-overflow: wrap\ntoc: true\nnumber-sections: false\neditor: visual\ncategories: [\"Fiche 2\", \"Marche aléatoire\", \"Signal linéraire bruité\"]\nimage: \"\"\ndescription: \"L'objectif de ce document est détudier la différence dans l'estimation de la tendance par régression linéaire entre une **marche aléatoire** et un **signal linéraire bruité**\"\n---\n\n\n\n# Intervenant.e.s\n\n### Rédaction\n\n-   **Clément Poupelin**, [clementjc.poupelin\\@gmail.com](mailto:clementjc.poupelin@gmail.com){.email}\\\n\n### Relecture\n\n-   \n\n# Setup\n\n:::: panel-tabset\n## Packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Données\nlibrary(dplyr)        # manipulation des données\n\n# Esthétique\nlibrary(latex2exp)   ## TeX\nlibrary(ggplot2)     ## ggplot\n```\n:::\n\n\n\n## Fonctions\n\n::: panel-tabset\n### Marche aléatoire\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrandom_walk <- function(n, delta) {\n  w <- rnorm(n)  \n  drift <- delta * seq(1, n)  \n  \n  x <- drift + cumsum(w)\n  return(x)  \n}\n```\n:::\n\n\n\n### Signal linéaire bruité\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnoisy_serie <- function(n, delta) {\n  w <- rnorm(n, sd = 1)  \n  drift <- delta * seq(1, n) \n  \n  x <- drift + w\n  return(x)  \n}\n```\n:::\n\n\n\n### Plot des simulations\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_simulation_time_series <- function(data, main_title, y_lab) {\n  plot_data <- data.frame(\n    Time = rep(1:n, I),\n    Value = as.vector(data),\n    Group = rep(1:I, each = n)\n  )\n  \n  ggplot(plot_data, aes(\n    x = Time,\n    y = Value,\n    group = Group,\n    color = factor(Group)\n  )) +\n    geom_line() +\n    scale_color_viridis_d(name = \"Time séries\")  +\n    labs(title = main_title,\n    x = \"Time\",\n    y = y_lab) +\n    theme_minimal() + \n    theme(legend.title = element_text(size = 18),\n          legend.text = element_text(size = 12),\n          axis.title = element_text(size = 16),\n          axis.text = element_text(size = 14),\n          plot.title = element_text(size = 18, face = \"bold\"))\n  \n}\n```\n:::\n\n\n\n### Plot des estimations \n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_estimations <- function(coeff, theo_trend_x.pos, theo_trend_y.pos) {\n  time <- seq(1, n)\n  \n  sim_data <- data.frame(\n    time = rep(time, I),\n    value = unlist(lapply(1:I, function(i)\n      coeff[i] * time)),\n    group = rep(1:I, each = n)\n  )\n  \n  theoretical_trend <- data.frame(time = time,\n                                  value = 0.01 * time,\n                                  group = \"Theoretical Trend\")\n  \n  p <- ggplot(sim_data, aes(\n    x = time,\n    y = value,\n    group = group,\n    color = factor(group)\n  )) +\n    geom_line(size = .5, color = \"orange\") +\n    geom_line(\n      data = theoretical_trend,\n      aes(x = time, y = value),\n      color = \"red\",\n      linetype = \"dashed\",\n      size = 1.\n    ) +\n    labs(\n      title = \"Graphe of the estimations\",\n      x = \"Time\",\n      y = \"Estimated values\",\n      color = \"Simulated Curves\"\n    ) +\n    scale_color_manual(values = rep(\"orange\", I)) +\n    theme_minimal() +\n    theme(legend.position = \"topleft\") +\n    annotate(\n      \"text\",\n      x = theo_trend_x.pos,\n      y = theo_trend_y.pos,\n      label = TeX(\"Theoretical trend$\\\\delta t = 0.01t$\"),\n      color = \"red\",\n      hjust = 0\n    )\n  return(p)\n}\n```\n:::\n\n\n\n\n:::\n\n## Seed\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(140400)\n```\n:::\n\n\n::::\n\n# Données\n\nPour cette exercice, nous allons étudier deux types de séries temporelles : **les marches aléatoires** et **les signaux linéaires bruités**.\n\nPour cela nous allons simuler :\n\n-   dix marches aléatoires $(x^1_t)_t$de la forme $x^1_t = \\delta + w_t$ avec dérive de longueur $n=100$, de paramètre $\\delta=.01$ et de variance $\\sigma_W^2 = 1$ pour le bruit.\n\n-   dix séries $(x^2_t)_t$ de la forme $x^2_t = \\delta t + w_t$ (tendance + bruit blanc) de longueur $n = 100$, de paramètre $\\delta = .01$ et de variance $\\sigma^2_W = 1$\n\n::: callout-note\nSi on pose que $x_0 = w_0$, on peut écrire notre marche aléatoire comme $x_t = \\delta t + \\sum_{i=0}^{t}w_i$\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 100      ## length    \ndelta <- .01  ## drift parameter   \nI <- 10       ## number of series\n```\n:::\n\n\n\n::: panel-tabset\n## Marche aléatoire\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim <- t(simplify2array(lapply(1:I, function(i) random_walk(n, delta))))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_simulation_time_series(sim, main_title = TeX(paste(\"Simulation of\", I, \"Random Walks with drift $\\\\delta$ =\", delta)), y_lab = \"Random Walk\")\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\n\n\n## Signal linéaire bruité\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim2 <- t(simplify2array(lapply(1:I, function(i) noisy_serie(n, delta))))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_simulation_time_series(sim2, main_title = paste(\"Simulation of\", I, \"linear noisy series\"), y_lab = \"Noisy serie\")\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-10-1.png){width=1152}\n:::\n:::\n\n\n:::\n\n# Estimation du modèle de régression linéaire\n\nPour les deux types de séries, nous allons estimer le modèle de régression linéaire $$x^\\xi_t = \\beta t + w_t \\quad \\text{pour} \\quad \\xi=1,2$$\n\n::: panel-tabset\n## Marche aléatoire\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_coeff <- apply(sim, 1, function(x) {\n  mod <- lm(x ~ 0 + seq(1, n)) \n  return(mod$coefficients)  \n})\n\ndf_sim_coeff <- data.frame(coeff = paste(\"beta_\", seq(1,10)), estimation = round(sim_coeff, 3))\n\nt(df_sim_coeff) %>% DT::datatable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-5ca2671e1d845ab306c1\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5ca2671e1d845ab306c1\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"coeff\",\"estimation\"],[\"beta_ 1\",\"-0.008\"],[\"beta_ 2\",\"-0.026\"],[\"beta_ 3\",\"-0.036\"],[\"beta_ 4\",\"-0.209\"],[\"beta_ 5\",\" 0.140\"],[\"beta_ 6\",\" 0.184\"],[\"beta_ 7\",\" 0.107\"],[\"beta_ 8\",\" 0.015\"],[\"beta_ 9\",\"-0.214\"],[\"beta_ 10\",\" 0.069\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>V1<\\/th>\\n      <th>V2<\\/th>\\n      <th>V3<\\/th>\\n      <th>V4<\\/th>\\n      <th>V5<\\/th>\\n      <th>V6<\\/th>\\n      <th>V7<\\/th>\\n      <th>V8<\\/th>\\n      <th>V9<\\/th>\\n      <th>V10<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"V1\",\"targets\":1},{\"name\":\"V2\",\"targets\":2},{\"name\":\"V3\",\"targets\":3},{\"name\":\"V4\",\"targets\":4},{\"name\":\"V5\",\"targets\":5},{\"name\":\"V6\",\"targets\":6},{\"name\":\"V7\",\"targets\":7},{\"name\":\"V8\",\"targets\":8},{\"name\":\"V9\",\"targets\":9},{\"name\":\"V10\",\"targets\":10}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n\n```{.r .cell-code}\nsim_coeff %>% summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n-0.214156 -0.033762  0.003651  0.002040  0.097599  0.183586 \n```\n\n\n:::\n:::\n\n\n:::: success-header\n::: success-icon\n:::\n\nRésultats\n::::\n\n::: success\nNous pouvons constater ici que les dix estimations varient entre $-0.21$ et $0.18$ avec une moyenne à $0.002$ alors que notre tendance théorique est à $.01$.\n:::\n\n\n## Signal linéaire bruité\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim2_coeff <- apply(sim2, 1, function(x) {\n  mod <- lm(x ~ 0 + seq(1, n))  \n  return(mod$coefficients)  \n})\ndf_sim2_coeff <- data.frame(coeff = paste(\"beta_\", seq(1,10)), estimation = round(sim2_coeff, 3))\n\nt(df_sim2_coeff) %>% DT::datatable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-b57d78979e16a7b99a95\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b57d78979e16a7b99a95\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"coeff\",\"estimation\"],[\"beta_ 1\",\"0.009\"],[\"beta_ 2\",\"0.010\"],[\"beta_ 3\",\"0.010\"],[\"beta_ 4\",\"0.013\"],[\"beta_ 5\",\"0.010\"],[\"beta_ 6\",\"0.013\"],[\"beta_ 7\",\"0.009\"],[\"beta_ 8\",\"0.011\"],[\"beta_ 9\",\"0.010\"],[\"beta_ 10\",\"0.010\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>V1<\\/th>\\n      <th>V2<\\/th>\\n      <th>V3<\\/th>\\n      <th>V4<\\/th>\\n      <th>V5<\\/th>\\n      <th>V6<\\/th>\\n      <th>V7<\\/th>\\n      <th>V8<\\/th>\\n      <th>V9<\\/th>\\n      <th>V10<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"V1\",\"targets\":1},{\"name\":\"V2\",\"targets\":2},{\"name\":\"V3\",\"targets\":3},{\"name\":\"V4\",\"targets\":4},{\"name\":\"V5\",\"targets\":5},{\"name\":\"V6\",\"targets\":6},{\"name\":\"V7\",\"targets\":7},{\"name\":\"V8\",\"targets\":8},{\"name\":\"V9\",\"targets\":9},{\"name\":\"V10\",\"targets\":10}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n\n```{.r .cell-code}\nsim2_coeff %>% summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n0.008750 0.009751 0.010156 0.010456 0.010601 0.013139 \n```\n\n\n:::\n:::\n\n\n:::: success-header\n::: success-icon\n:::\n\nRésultats\n::::\n\n::: success\nNous pouvons constater ici que les dix estimations son proche de $.01$ qui est notre tendance théorique.\n:::\n\n:::\n\nAvec ces résulats, nous pouvons par la suite représenter sur un même graphique dix droites représentant l'évolution de nos séries à partir de nos dix estimations et une droite avec l'évolution de la série avec la tendance théorique $\\delta t=.01t$.\n\n::::::::: panel-tabset\n## Marche aléatoire\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_estimations(sim_coeff, 5, 9)\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n:::: success-header\n::: success-icon\n:::\n\nRésultats\n::::\n\n::: success\nNous pouvons facilement voir que les estimations ne semble pas du tout suivre la tendance moyenne théoriques.\\\nLa variance des estimations semble même croitre au cours du temps.\n:::\n\n## Signal linéaire bruité\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_estimations(sim2_coeff, 0.2, 0.5)\n```\n\n::: {.cell-output-display}\n![](Exercice_02.01_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n:::: success-header\n::: success-icon\n:::\n\nRésultats\n::::\n\n::: success\nNous constatons ici que l'estimation semble très bien fonctionner avec des lignes qui semblent toutes proches de la tendance moyenne théorique.\n:::\n:::::::::\n\n# Conclusion\n\nNous avons pu voir avec cette exercice que la tendance théorique (le drift) est mieux estimée par régression linéaire dans le cas d'un signal bruité que celui de la marche aléatoire.\n\nCela s'explique par le fait que, dans le cas de la marche aléatoire, la variance de $x_t$ croît linéairement avec le temps. En effet, \\begin{align*} \nVar(x_t) &= Var(\\delta t + \\sum_{i=0}^{t}w_i)\\\\\n&= Var(\\sum_{i=0}^{t}w_i)\\\\ \n&= \\sum_{i=0}^{t}Var(w_i)\\\\ \n&= \\sum_{i=0}^{t}\\sigma^2_w\\\\ \n&= t\\sigma^2_w \n\\end{align*}\n\nCela fait donc défaut à l'hypothèse d'homoscédacité (la variance des erreurs est la même pour chaque observation) cruciale pour la régression linéaire.\n\nPar contre, du côté du signal bruité on conserve l'homoscédacité avec le cas très idéal du bruit iid (indépendant et identiquement distribué) et gaussien.\n\n# Session info\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info(pkgs = \"attached\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.2 (2024-10-31)\n os       Ubuntu 24.04.1 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  fr_FR.UTF-8\n ctype    fr_FR.UTF-8\n tz       Europe/Paris\n date     2025-03-03\n pandoc   3.2 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/x86_64/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package   * version date (UTC) lib source\n dplyr     * 1.1.4   2023-11-17 [1] CRAN (R 4.4.2)\n ggplot2   * 3.5.1   2024-04-23 [1] CRAN (R 4.4.2)\n latex2exp * 0.9.6   2022-11-28 [1] CRAN (R 4.4.2)\n\n [1] /home/clement/R/x86_64-pc-linux-gnu-library/4.4\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n",
    "supporting": [
      "Exercice_02.01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}