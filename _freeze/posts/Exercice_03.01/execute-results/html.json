{
  "hash": "e0042ed2631898a6cad0d96e3d9b3e9e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercie 3.1\"\nauthor: \"Clément Poupelin\"\ndate: \"2025-02-xx\"\ndate-modified: \"2025-02-28\"\nformat: \n  html:\n    embed-resources: false\n    toc: true\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-tools: true\n    toc-location: right\n    page-layout: article\n    code-overflow: wrap\ntoc: true\nnumber-sections: false\neditor: visual\ncategories: [\"Fiche 3\", \"Tendance\", \"Saisonnalité\"]\nimage: \"\"\ndescription: \"Nous allons illustrer l'étude de la **tendance** et de la **saisonnalité** à partir d'une base de données sur la vente de voitures\"\n---\n\n\n\n# Intervenant.e.s\n\n### Rédaction\n\n-   **Clément Poupelin**, [clementjc.poupelin\\@gmail.com](mailto:clementjc.poupelin@gmail.com){.email}\\\n\n### Relecture\n\n-   \n\n# Setup\n\n:::: panel-tabset\n## Packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Données\nlibrary(dplyr)        # manipulation des données\n\nlibrary(latex2exp)\n\n# Plots\n## ggplot\nlibrary(ggplot2)\nlibrary(gridExtra)\n```\n:::\n\n\n\n## Fonctions\n\n::: panel-tabset\n### Fonction 1\n\n### Fonction 2\n:::\n\n## Seed\n::::\n\n# Données\n\n**Tendance et saisonnalité** : étude de la série de vente de voitures. http://www.math.sciences.univ-nantes.fr/\\~philippe/lecture/voiture.txt\n\nOn conserve uniquement le début de la série avant la rupture.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl_TP3 = \"http://www.math.sciences.univ-nantes.fr/~philippe/lecture/voiture.txt\"\nX = scan(url_TP3) # pour importer le dataframe en 1 vecteur de donnée (et non un dataframe de dim n*m)\n\nXt = ts(X, frequency =12)\n# On fixe une fréquence de 12 \n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\nOn constate une rupture au niveau du temps 24. On ne conserve donc que la première partie pour notre analyse.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nXt = window(Xt, start=start(Xt), end=24)\n```\n:::\n\n\n\n\nQUESTION 1 : A l’aide de la suite des covariances empiriques, mettre en évidence la présence d’une tendance et d’une composante saisonnière dans cette série\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\n\nOn constate effectivement une tendance globale sur toute la série au vu de nos deux graphes. De plus, l'ACF nous permet de voir une composante saisonnière qui serait probablement de période 12.\n\n# Anayse inférentielle\n\n::: panel-tabset\n\n## Approche 1\n\nQUESTION 2 : Estimer la tendance et la composante saisonnière de cette série\n\nPour cette partie, on peut se référé au cours de Séries Temporelle (slides 37-51).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#### ETAPE 1 : LISSAGE/FILTRAGE ####\n\n# on suppose période 12 d'après l'acf\nd = 12\n# si période d pair, filtre :\na = c(1/2,rep(1,d-1),1/2)/d\n\nm = stats::filter(Xt, a, sides = 2)\nZ = Xt - m\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n\nLe lissage d'une série chronologique (ou le filtrage) est utilisé pour découvrir certaines caractéristiques d'une série temporelle, telles que la tendance et les composantes saisonnières.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#### ETAPE 2 : ELIMINATION SAISONNALITE ET TENDANCE ####\n\n# Saisonnalité\nZ = ts(Z, frequency = d) # impose la fréquence/période\ns.est = 1:12\nfor ( i in 1:12 ){\n  s.est[i]= mean(Z[cycle(Z) == i] , na.rm=TRUE)\n}\n\n\nS.est = ts(rep(s.est,d), frequency = frequency(Xt)) # Saisonnalité estimée\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Tendance \n\nQ = Xt - s.est \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in `-.default`(Xt, s.est): la taille d'un objet plus long n'est pas\nmultiple de la taille d'un objet plus court\n```\n\n\n:::\n\n```{.r .cell-code}\nmod = lm(Q ~ time(Q)) # time(Q) ca fait 1:lenght(Q)\nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Q ~ time(Q))\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-51203 -10213   -318   9711  36567 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  57964.5     1882.0   30.80   <2e-16 ***\ntime(Q)       4958.3      132.9   37.32   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 14730 on 275 degrees of freedom\nMultiple R-squared:  0.8351,\tAdjusted R-squared:  0.8345 \nF-statistic:  1393 on 1 and 275 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nP.est = ts(mod$fitted.values, frequency = frequency(Xt)) # Tendance estimée\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\nQUESTION 3 : Éliminer la tendance et la composante saisonnière à partir de vos estimations. On note $(R_j)_j$ la série obtenue\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRj = Xt - P.est - S.est\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n:::\n\n\n\n\n QUESTION 4 : La série $(R_j)_j$ peut elle être modélisée par un bruit blanc ? Discuter le résultat\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n:::\n\n\n\non a l'impression d'avoir un bruit u peu centré $(E(R_j)=0)$ mais pas dingue avec une variance pas super constante. Mais, avec l'acf, ont voit tout de meme une corrélation faible qui pourrait faire pensé à un BB.\n\nCONCLUSION : ??\n\nNormalité (Test shapiro)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(Rj)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  Rj\nW = 0.98218, p-value = 0.05807\n```\n\n\n:::\n:::\n\n\n\nVérification par le test de Shapiro-Wilk (normalité : p-value \\> 0,05) On garde l'hypothèse de la normalité\n\nCorrélation\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(1:length(Rj), Rj)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  1:length(Rj) and Rj\nt = 2.1745, df = 142, p-value = 0.03133\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.01641902 0.33330168\nsample estimates:\n      cor \n0.1795128 \n```\n\n\n:::\n:::\n\n\n\nLes deux valeurs importantes de ce résultat sont la corrélation (50%) et sa p-value (1\\*10\\^-8%). Le test nous dit en outre qu’il y a 95% de chances que la “véritable corrélation” entre temps et valeur soit comprise dans “l’intervalle de confiance” entre 36% et 61%. Notez que 0% est un nombre non inclus dans cette fourchette: en d’autres mots, il se pourrait très bien que valeur et temps soient du tout corrélés. En bref, l’algorithme détecte une corrélation.\n\n\nLe test de la statisticienne finnoise Greta Ljung (et de son directeur de thèse George Box) examine l’autocorrélation d’une série temporelle. Son “hypothèse nulle” est d’avoir affaire à du “bruit blanc”.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBox.test(Rj, type=\"Ljung-Box\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBox-Ljung test\n\ndata:  Rj\nX-squared = 26.159, df = 1, p-value = 3.145e-07\n```\n\n\n:::\n:::\n\n\n\nLa p-value est faible (8e-09). Le test nous permet donc de rejeter l’hypothèse d’avoir affaire à du bruit blanc\n\n\n\n## Approche 2\n\nQUESTION 5 : Éliminer la tendance et la composante saisonnière en appliquant un ou plusieurs filtres linéaires de la forme $(I − L^s)^d$. On note $(R'_j)_j$ la série obtenue.\n\nEtant donné que l'on a détecter une tendance et une saisonnalité de période 12, on peut tenter une différenciation de la série avec $s=12$ et $d=1$.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR1 = diff(Xt, lag=12)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-18-2.png){width=672}\n:::\n:::\n\n\n\npour enlever le pb en 12, on se propose d'appliquer à nouveau la différence\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR2 = diff(R1)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Exercice_03.01_files/figure-html/unnamed-chunk-20-2.png){width=672}\n:::\n:::\n\n\n\nQUESTION 6 : La série $(R'_j)_j$ peut elle être modélisée par un bruit blanc ? Discuter le résultat\n\n\n\n:::\n\n\n\n# Conclusion\n\n# Session info\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info(pkgs = \"attached\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.2 (2024-10-31)\n os       Ubuntu 24.04.1 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  fr_FR.UTF-8\n ctype    fr_FR.UTF-8\n tz       Europe/Paris\n date     2025-02-28\n pandoc   3.2 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/x86_64/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package   * version date (UTC) lib source\n dplyr     * 1.1.4   2023-11-17 [1] CRAN (R 4.4.2)\n ggplot2   * 3.5.1   2024-04-23 [1] CRAN (R 4.4.2)\n gridExtra * 2.3     2017-09-09 [1] CRAN (R 4.4.2)\n latex2exp * 0.9.6   2022-11-28 [1] CRAN (R 4.4.2)\n\n [1] /home/clement/R/x86_64-pc-linux-gnu-library/4.4\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n",
    "supporting": [
      "Exercice_03.01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}